<!DOCTYPE html>

<html>
    <head>
        <!-- usually this can just be the headline -->
        <title>GrabAGrad</title>

    <!-- HTML Meta Tags -->
        <title>GrabAGrad</title>
        <meta name="description" content="Displays all of the graduate members of GrabAGrad">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="favicon icon" href="{{ url_for('static', filename='favicon.ico') }}">
        <link href="{{ url_for('static', filename= 'styles.css') }}" rel="stylesheet" type="text/css" />
        <script src="{{url_for('static', filename='script.js')}}"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    </head>


    <body onload="reportWindowSize()" style="font-family: 'Lato', sans-serif;">
        <div class="header">
            <span class="menu-closed menu-button" onclick="openNav()">&#9776;</span>
            <a style="text-decoration: none" href="/">Home</a>
            <!--<a style="text-decoration: none" href="/form">Create a Profile</a>-->
            <a style="text-decoration: none" href="/about">About GrabAGrad</a>
            <span class="title">GrabAGrad</span>
        </div>
        <span id="top"></span>
        <div id="mySidenav" style="transition: ease .3s; width: 360px" class="sidenav">
            <div id="filter">
                <br>
                <p style="margin-bottom: 15px;">Filter By:</p>
                <form style="text-align: left;">
                    <input class="search-filter" id="name" name="name" type="text" placeholder="Name"></intput>
                    <input class="search-filter" id="dept" name="dept" type="text" placeholder="Department"></intput>
                    <input class="search-filter" id="industry" name="industry" type="text" placeholder="Industry"></intput>
                    <input class="search-filter" id="years-worked" name="years-worked" type="text" placeholder="Years Worked"></intput>
                    <input class="search-filter" id="un-uni" name="un-uni" type="text" placeholder="Undergraduate University"></intput>
                </form>
                <div class="small-screen">
                    <br>
                </div>

                <div class="sorter">
                    <p class="sortby">Sort By:</p>
                        <select id="sortby" name="sortby">
                            <option value="First Name: A-Z">First Name: A-Z</option>
                            <option value="First Name: Z-A">First Name: Z-A</option>
                        </select>
                </div>
            </div>
        </div>
        <a class="backToTop" style="transition: height 250ms ease-in;" href="#top">Back To Top</a>

        <div id="details" class="details details-closed" style="visibility: hidden; transition: ease .3s;">
            <div onclick="details()" class="close"></div>
            <div id='popup_details'></div>
        </div>
    
        <div id="main" style="margin-left: 315px; transition: ease .3s;">
            <div id="grad_cards" class="flexer"></div>
        </div>

        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js'>
        </script>

            <script>

            'use strict';

            let request = null;


            function render_popup(response) {
                console.log("Popup rendered")
                $('#popup_details').html(response);
                details();
            }


            function view_popup(grad_id) {
                console.log('Popup opened');
                console.log(grad_id);

                let url = '/popup?id=' + grad_id;
                request = $.ajax(
                   {
                      type: 'GET',
                      url: url,
                      success: render_popup
                   }
                );
            }

            function filterResponse(response)
            {
                 console.log('New filters applied');
                 $('#grad_cards').html(response);
            }

            function filterResults() {
                let name = $('#name').val();
                let dept = $('#dept').val();
                let industry = $('#industry').val();
                let years_worked = $('#years-worked').val();
                let un_uni = $('#un-uni').val();
                let sortby = $('#sortby').val();

                name = encodeURIComponent(name);
                dept = encodeURIComponent(dept);
                industry = encodeURIComponent(industry);
                years_worked = encodeURIComponent(years_worked);
                un_uni = encodeURIComponent(un_uni);
                sortby = encodeURIComponent(sortby);

                let url = '/filter_grads?name=' + name + '&dept=' + dept +
                          '&industry=' + industry + '&years_worked=' + 
                          years_worked + '&un_uni=' + un_uni + '&sortby=' + sortby

                if (request !== null)
                   request.abort();

                request = $.ajax(
                   {
                      type: 'GET',
                      url: url,
                      success: filterResponse
                   }
                );
            }

            function setup()
            {
                $('#name').on('input', filterResults);
                $('#dept').on('input', filterResults);
                $('#industry').on('input', filterResults);
                $('#years-worked').on('input', filterResults);
                $('#un-uni').on('input', filterResults);
                $('#sortby').on('change', filterResults);

                filterResults();
            }

            $('document').ready(setup);
            </script>
    </body>
    </html>